function initialize() {
	var cache = [],

		action = {
			'REGISTER': function (message) {
				cache.push(new Function('return '+ message.fn)());
				process.send({
					ticket: message.ticket,
					data: {
						index: cache.length - 1
					}
				});
			},

			'EXECUTE': function (message) {
				var fn = cache[message.index],
					args = message.args,
					ticket = message.ticket;

				args.push(function (data, handle) {
					process.send({
						ticket: ticket,
						data: data
					}, handle);
				});

				if (fn) {
					fn.apply({
						require: require,
						exports: exports,
						module: module
					}, args)
				}
			},

			'EXIT': function () {
				process.exit();
			}
		};

	process.on('message', function (message) {
		if (action[message.type]) {
			action[message.type](message);
		}
	});
}

initialize();
